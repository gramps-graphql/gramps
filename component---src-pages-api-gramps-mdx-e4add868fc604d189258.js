(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{379:function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return s})),a.d(t,"default",(function(){return b}));a(11),a(5),a(6),a(2),a(10),a(1),a(0);var n=a(103),r=a(395);function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}var p,s={},c=(p="PageDescription",function(e){return console.warn("Component "+p+" was not imported, exported, or provided by MDXProvider as global scope"),Object(n.b)("div",e)}),i={_frontmatter:s},l=r.a;function b(e){var t=e.components,a=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,["components"]);return Object(n.b)(l,o({},i,a,{components:t,mdxType:"MDXLayout"}),Object(n.b)(c,{mdxType:"PageDescription"},Object(n.b)("p",null,"The ",Object(n.b)("inlineCode",{parentName:"p"},"@gramps/gramps")," package exports two functions that allow ",Object(n.b)("a",o({parentName:"p"},{href:"https://gramps.js.org/data-source/schema-stitching/"}),"GrAMPS data sources")," to be combined."),Object(n.b)("p",null,"Under the hood, this is done by merging all the of data sources, applying schema stitching as needed, merging context objects, and a few other checks and chores to make it easy for developers to quickly build GraphQL servers from separate data sources."),Object(n.b)("p",null,"See the API docs below for the all available options, expected return values, and usage examples.")),Object(n.b)("h2",{id:"grampsoptions"},Object(n.b)("inlineCode",{parentName:"h2"},"gramps(options)")),Object(n.b)("p",null,"The main function exported by the GrAMPS package, this generates ",Object(n.b)("inlineCode",{parentName:"p"},"GraphQLOptions")," as a function that’s ",Object(n.b)("a",o({parentName:"p"},{href:"https://www.apollographql.com/docs/apollo-server/setup.html#options-function"}),"consumable by ",Object(n.b)("inlineCode",{parentName:"a"},"apollo-server")),"."),Object(n.b)("h4",{id:"parameters"},"Parameters"),Object(n.b)("p",null,"The ",Object(n.b)("inlineCode",{parentName:"p"},"gramps")," function accepts an ",Object(n.b)("inlineCode",{parentName:"p"},"options")," object which has the following properties:"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},Object(n.b)("p",{parentName:"li"},Object(n.b)("strong",{parentName:"p"},Object(n.b)("inlineCode",{parentName:"strong"},"options.dataSources"))),Object(n.b)("p",{parentName:"li"},Object(n.b)("em",{parentName:"p"},"Default: ",Object(n.b)("inlineCode",{parentName:"em"},"[]"))),Object(n.b)("p",{parentName:"li"},"An array of ",Object(n.b)("a",o({parentName:"p"},{href:"https://gramps.js.org/data-source/data-source-overview/"}),"GrAMPS data sources")," to be combined.")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("p",{parentName:"li"},Object(n.b)("strong",{parentName:"p"},Object(n.b)("inlineCode",{parentName:"strong"},"options.enableMockData"))),Object(n.b)("p",{parentName:"li"},Object(n.b)("em",{parentName:"p"},"Default: ",Object(n.b)("inlineCode",{parentName:"em"},"process.env.GRAMPS_MODE === 'mock'"))),Object(n.b)("p",{parentName:"li"},"A boolean value determining whether or not mock resolvers should be added to the schema.")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("p",{parentName:"li"},Object(n.b)("strong",{parentName:"p"},Object(n.b)("inlineCode",{parentName:"strong"},"options.extraContext"))),Object(n.b)("p",{parentName:"li"},Object(n.b)("em",{parentName:"p"},"Default: ",Object(n.b)("inlineCode",{parentName:"em"},"req => ({})"))),Object(n.b)("p",{parentName:"li"},"An optional function that returns additional context to be passed to the resolvers. Must return an object.")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("p",{parentName:"li"},Object(n.b)("strong",{parentName:"p"},Object(n.b)("inlineCode",{parentName:"strong"},"options.logger"))),Object(n.b)("p",{parentName:"li"},Object(n.b)("em",{parentName:"p"},"Default: ",Object(n.b)("inlineCode",{parentName:"em"},"console"))),Object(n.b)("p",{parentName:"li"},"An optional logger tool. Must expose ",Object(n.b)("inlineCode",{parentName:"p"},"warn")," and ",Object(n.b)("inlineCode",{parentName:"p"},"error")," methods.")),Object(n.b)("li",{parentName:"ul"},Object(n.b)("p",{parentName:"li"},Object(n.b)("strong",{parentName:"p"},Object(n.b)("inlineCode",{parentName:"strong"},"options.apollo"))),Object(n.b)("p",{parentName:"li"},Object(n.b)("em",{parentName:"p"},"Default: ",Object(n.b)("inlineCode",{parentName:"em"},"{}"))),Object(n.b)("p",{parentName:"li"},"Under the hood, GrAMPS executes the ",Object(n.b)("inlineCode",{parentName:"p"},"makeExecutableSchema")," (",Object(n.b)("a",o({parentName:"p"},{href:"https://www.apollographql.com/docs/graphql-tools/generate-schema.html#makeExecutableSchema"}),"docs"),") and ",Object(n.b)("inlineCode",{parentName:"p"},"addMockFunctionsToSchema")," (",Object(n.b)("a",o({parentName:"p"},{href:"https://www.apollographql.com/docs/graphql-tools/mocking.html#addMockFunctionsToSchema"}),"docs"),") functions from ",Object(n.b)("inlineCode",{parentName:"p"},"graphql-tools"),". It also returns a configuration object for an Apollo server (",Object(n.b)("a",o({parentName:"p"},{href:"https://www.apollographql.com/docs/apollo-server/setup.html#graphqlOptions"}),"docs"),"). Use this option to pass additional configuration options to these function calls."),Object(n.b)("p",{parentName:"li"},"For example, to set ",Object(n.b)("inlineCode",{parentName:"p"},"allowUndefinedInResolve")," to ",Object(n.b)("inlineCode",{parentName:"p"},"false")," for debugging, set the option like this:"),Object(n.b)("pre",{parentName:"li"},Object(n.b)("code",o({parentName:"pre"},{className:"language-js"}),"const GraphQLOptions = gramps({\n  dataSources: [/* ... */],\n  apollo: {\n    makeExecutableSchema: {\n      allowUndefinedInResolve: false,\n    },\n  },\n});\n")),Object(n.b)("p",{parentName:"li"},Object(n.b)("strong",{parentName:"p"},"NOTE:")," The ",Object(n.b)("inlineCode",{parentName:"p"},"typeDefs")," and ",Object(n.b)("inlineCode",{parentName:"p"},"resolvers")," arguments to ",Object(n.b)("inlineCode",{parentName:"p"},"makeExecutableSchema")," are set by GrAMPS, so any values set for them in the ",Object(n.b)("inlineCode",{parentName:"p"},"apollo")," options will be overridden."))),Object(n.b)("h4",{id:"return-value"},"Return Value"),Object(n.b)("p",null,"A function that accepts the request and returns a ",Object(n.b)("inlineCode",{parentName:"p"},"GraphQLOptions")," object. See ",Object(n.b)("a",o({parentName:"p"},{href:"https://www.apollographql.com/docs/apollo-server/setup.html#options-function"}),"the apollo-server docs")," for more information."),Object(n.b)("h4",{id:"example-of-usage"},"Example of Usage"),Object(n.b)("p",null,"A simple example:"),Object(n.b)("pre",null,Object(n.b)("code",o({parentName:"pre"},{className:"language-js"}),"import gramps from '@gramps/gramps';\nimport XKCD from '@gramps/data-source-xkcd';\n\nconst GraphQLOptions = gramps({ dataSources: [XKCD] });\n// => `GraphQLOptions` is valid config for any flavor of apollo-server\n")),Object(n.b)("p",null,"A complete example:"),Object(n.b)("pre",null,Object(n.b)("code",o({parentName:"pre"},{className:"language-js"}),"import gramps from '@gramps/gramps';\nimport XKCD from '@gramps/data-source-xkcd';\nimport getPino from 'pino';\n\nconst pino = getPino({ prettyPrint: true });\npino.log = pino.info; // logger must expose a `log` method\n\nconst GraphQLOptions = gramps({\n  dataSources: [XKCD],\n  enableMockData: true,\n  extraContext: req => ({\n    token: req.users.token,\n  }),\n  logger: pino,\n  apollo: {\n    addMockFunctionsToSchema: {\n      preserveResolvers: false,\n    },\n    makeExecutableSchema: {\n      logger: pino,\n      allowUndefinedInResolve: false,\n    },\n    apolloServer: {\n      debug: true,\n    },\n  }\n});\n")),Object(n.b)("h2",{id:"prepareoptions"},Object(n.b)("inlineCode",{parentName:"h2"},"prepare(options)")),Object(n.b)("p",null,"In some use cases, it’s better to get ",Object(n.b)("a",o({parentName:"p"},{href:"https://www.apollographql.com/docs/apollo-server/setup.html#options-function"}),Object(n.b)("inlineCode",{parentName:"a"},"GraphQLOptions"))," as an object instead of a function (for example, if you’re planning to do ",Object(n.b)("a",o({parentName:"p"},{href:"https://gramps.js.org/data-source/schema-stitching/"}),"schema stitching")," between your data sources)."),Object(n.b)("p",null,"In those use cases, you can use the ",Object(n.b)("inlineCode",{parentName:"p"},"prepare")," function, which is a named export from ",Object(n.b)("inlineCode",{parentName:"p"},"@gramps/gramps"),"."),Object(n.b)("h4",{id:"parameters-1"},"Parameters"),Object(n.b)("p",null,"The ",Object(n.b)("inlineCode",{parentName:"p"},"prepare")," function accepts an ",Object(n.b)("inlineCode",{parentName:"p"},"options")," object that is identical to the ",Object(n.b)("inlineCode",{parentName:"p"},"gramps()")," function’s."),Object(n.b)("h4",{id:"return-value-1"},"Return Value"),Object(n.b)("p",null,"Returns a ",Object(n.b)("inlineCode",{parentName:"p"},"GraphQLOptions")," object that can be passed directly to any Apollo server."),Object(n.b)("p",null,"Additionally, it exposes an ",Object(n.b)("inlineCode",{parentName:"p"},"addContext")," method that follows the middleware pattern of ",Object(n.b)("inlineCode",{parentName:"p"},"(req, res, next) => {}")," to allow execution of the ",Object(n.b)("inlineCode",{parentName:"p"},"extraContext")," function."),Object(n.b)("h4",{id:"example-of-usage-1"},"Example of Usage"),Object(n.b)("pre",null,Object(n.b)("code",o({parentName:"pre"},{className:"language-js"}),"import Express from 'express';\nimport bodyParser from 'body-parser';\nimport { graphqlExpress, graphiqlExpress } from 'apollo-server-express';\nimport { mergeSchemas } from 'graphql-tools';\nimport { prepare } from '@gramps/gramps';\nimport XKCD from '@gramps/data-source-xkcd';\nimport Numbers from '@gramps/data-source-numbers';\n\nconst gramps = prepare({\n  dataSources: [XKCD, Numbers],\n  extraContext: req => ({ req }), // adds the request to the context\n});\n\n// Add a field that pulls number trivia for the given XKCD comic’s number\nconst linkTypeDefs = `\n  extend type XKCD_Comic {\n    numbers: Numbers_Trivia\n  }\n`;\n\n// Add a resolver to make the above field actually work\nconst schema = mergeSchemas({\n  schemas: [gramps.schema, linkTypeDefs], // use `gramps.schema` for merging\n  resolvers: mergeInfo => ({\n    XKCD_Comic: {\n      numbers: {\n        fragment: `fragment XKCDFragment on XKCD_Comic { num }`,\n        resolve: (parent, args, context, info) => {\n          return mergeInfo.delegate(\n            'query',\n            'trivia',\n            { number: parent.num },\n            context,\n            info\n          );\n        }\n      }\n    }\n  })\n});\n\nconst app = new Express();\n\napp.use('/graphql',\n  bodyParser.json(),\n  gramps.addContext,         // Add the extra context\n  graphqlExpress({\n    schema,                  // Use the merged schema...\n    context: gramps.context, // ...and the GrAMPS context object\n  }),\n);\n\napp.use('/graphiql', graphiqlExpress({ endpointURL: '/graphql' }));\n\napp.listen(8080);\n")))}b.isMDXComponent=!0},393:function(e){e.exports=JSON.parse('{"data":{"site":{"pathPrefix":""}}}')},394:function(e){e.exports=JSON.parse('{"data":{"site":{"siteMetadata":{"repository":{"baseUrl":"","subDirectory":""}}}}}')},395:function(e,t,a){"use strict";a(35),a(27);var n=a(1),r=a(393),o=a(0),p=a.n(o),s=a(102),c=a.n(s),i=a(188),l=a(121),b=a(3),m=a.n(b),d=a(373),u=function(e){var t,a=e.title,r=e.tabs,o=void 0===r?[]:r;return Object(n.b)("div",{className:m()(d.pageHeader,(t={},t[d.withTabs]=o.length,t))},Object(n.b)("div",{className:"bx--grid"},Object(n.b)("div",{className:"bx--row"},Object(n.b)("div",{className:"bx--col-lg-12"},Object(n.b)("h1",{id:"page-title",className:d.text},a)))))},h=a(394),j=a(374),g=function(e){var t=e.relativePagePath,a=e.repository,r=h.data.site.siteMetadata.repository,o=a||r,p=o.baseUrl,s=p+"/tree/master"+o.subDirectory+"/src/pages"+t;return p?Object(n.b)("div",{className:"bx--row "+j.row},Object(n.b)("div",{className:"bx--col"},Object(n.b)("a",{className:j.link,href:s},"Edit this page on GitHub"))):null},O=a(186),f=a(28),N=a(375);var x=function(e){var t,a;function r(){return e.apply(this,arguments)||this}return a=e,(t=r).prototype=Object.create(a.prototype),t.prototype.constructor=t,t.__proto__=a,r.prototype.render=function(){var e=this.props,t=e.tabs,a=e.slug,r=a.split("/").filter(Boolean).slice(-1)[0],o=t.map((function(e){var t,o=c()(e,{lower:!0}),p=o===r,s=a.replace(r,o);return Object(n.b)("li",{key:e,className:m()((t={},t[N.selectedItem]=p,t),N.listItem)},Object(n.b)(f.Link,{className:N.link,to:""+s},e))}));return Object(n.b)("div",{className:N.tabsContainer},Object(n.b)("div",{className:"bx--grid"},Object(n.b)("div",{className:"bx--row"},Object(n.b)("div",{className:"bx--col-lg-12 bx--col-no-gutter"},Object(n.b)("nav",null,Object(n.b)("ul",{className:N.list},o))))))},r}(p.a.Component),v=a(187);t.a=function(e){var t=e.pageContext,a=e.children,o=e.location,p=t.frontmatter,s=void 0===p?{}:p,b=t.relativePagePath,m=t.titleType,d=s.tabs,h=s.title,j=s.theme,f=s.description,N=s.keywords,C=r.data.site.pathPrefix,w=C?o.pathname.replace(C,""):o.pathname,y=d?w.split("/").slice(-1)[0]||c()(d[0],{lower:!0}):"";return Object(n.b)(l.a,{homepage:!1,theme:j,pageTitle:h,pageDescription:f,pageKeywords:N,titleType:m},Object(n.b)(u,{title:h,label:"label",tabs:d}),d&&Object(n.b)(x,{slug:w,tabs:d,currentTab:y}),Object(n.b)(v.a,{padded:!0},a,Object(n.b)(g,{relativePagePath:b})),Object(n.b)(O.a,{pageContext:t,location:o,slug:w,tabs:d,currentTab:y}),Object(n.b)(i.a,null))}}}]);
//# sourceMappingURL=component---src-pages-api-gramps-mdx-e4add868fc604d189258.js.map